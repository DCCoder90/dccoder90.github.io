---
export async function getStaticPaths() {
  // Get all posts
  const posts = await Astro.glob('./posts/**/*.md');

  // Filter out posts without valid frontmatter
  const validPosts = posts.filter(post => post && post.frontmatter && post.frontmatter.title);

  // Generate a route ONLY for posts with CUSTOM permalinks (not matching file path)
  return validPosts.map((post) => {
    // Get permalink from frontmatter
    const permalink = post.frontmatter.permalink;

    // Get the file-based URL
    const fileUrl = post.url;

    if (!permalink) {
      return null;
    }

    // Skip if permalink matches the file-based route (no custom permalink)
    if (permalink === fileUrl || permalink + '/' === fileUrl || permalink === fileUrl + '/') {
      return null;
    }

    // Remove leading and trailing slashes for the param
    const cleanPermalink = permalink.replace(/^\/|\/$/g, '');

    return {
      params: { permalink: cleanPermalink },
      props: {
        Content: post.Content,
      },
    };
  }).filter(Boolean);
}

const { Content } = Astro.props;
---

<Content />
